<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Study Planner</title>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
             integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

        <!-- JS -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
                integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
                integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
                integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

        <!-- 구글폰트 -->
        <link href="https://fonts.googleapis.com/css2?family=Song+Myung&display=swap" rel="stylesheet">

        <!-- js 연결 -->
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
        <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>

        <!-- 시간 설정 버튼-->
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <!-- 쿠키 사용을 위한 Jquery-cookie 임포트 -->
<!--        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

	    <link rel="stylesheet" href="/static/main.css" type="text/css">

        <!--- 달력 --->
        <link href='static/fullcalendar.css' rel='stylesheet' />
        <link href='static/fullcalendar.print.css' rel='stylesheet' media='print' />
        <script src='static/jquery-1.10.2.js' type="text/javascript"></script>

        <script src='static/jquery-ui.custom.min.js' type="text/javascript"></script>
        <script src='static/fullcalendar.js' type="text/javascript"></script>

        <!--- 쿠키 --->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>


        <script>

            $(document).ready(function() {
                var date = new Date();
                var d = date.getDate();
                var m = date.getMonth();
                var y = date.getFullYear();

                    /*  className colors

                    className: default(transparent), important(red), chill(pink), success(green), info(blue)

                    */


                    /* initialize the external events
                    -----------------------------------------------------------------*/

                $('#external-events div.external-event').each(function () {

                    // create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)
                    // it doesn't need to have a start or end
                    var eventObject = {
                        title: $.trim($(this).text()) // use the element's text as the event title
                    };

                    // store the Event Object in the DOM element so we can get to it later
                    $(this).data('eventObject', eventObject);

                        // make the event draggable using jQuery UI
                        $(this).draggable({
                            zIndex: 999,
                            revert: true,      // will cause the event to go back to its
                            revertDuration: 0  //  original position after the drag
                        });

                    });


                    /* initialize the calendar
                    -----------------------------------------------------------------*/

                    var calendar = $('#calendar').fullCalendar({
                        header: {
                            left: 'title',
                            center: 'month',
                            right: 'prev,next today'
                        },

                        editable: true,
                        firstDay: 1, //  1(Monday) this can be changed to 0(Sunday) for the USA system
                        selectable: true,
                        defaultView: 'month',

                        axisFormat: 'h:mm',
                        columnFormat: {
                            month: 'ddd',    // Mon
                            week: 'ddd d', // Mon 7
                            day: 'dddd M/d',  // Monday 9/7
                            agendaDay: 'dddd d'
                        },
                        titleFormat: {
                            month: 'MMMM yyyy', // September 2009
                            week: "MMMM yyyy", // September 2009
                            day: 'MMMM yyyy'                  // Tuesday, Sep 8, 2009
                        },
                        allDaySlot: false,
                        selectHelper: true,
                        select: function (start, end, allDay) {
                            let title = prompt('공부 뭐 했니? :');
                            if (title) {
                                calendar.fullCalendar('renderEvent',
                                    {
                                        title: title,
                                        start: start,
                                        end: end,
                                        allDay: allDay
                                    },
                                    true // make the event "stick"
                                );
                            }
                            calendar.fullCalendar('unselect');

                            // 현재날짜 출력됨
                            let moment = $('#calendar').fullCalendar('getDate');
                            console.log(moment)

                            $.ajax({
                                type: 'POST',
                                url: "/api/calendar",
                                data: {'title_give': title},
                                success: function (response) {
                                    if(response['result']!='success') {
                                        alert('정보가 입력되지 않았습니다');
                                        return ;
                                    }

                                    $('#calendar').fullCalendar('renderEvent',
                                        {
                                            title:title,
                                            start:new Date(y,m,d),
                                            allDay:true,
                                            className:'info'
                                        }
                                    )
                                }
                            });
                        },
                        droppable: true, // this allows things to be dropped onto the calendar !!!
                        drop: function (date, allDay) { // this function is called when something is dropped

                            // retrieve the dropped element's stored Event Object
                            var originalEventObject = $(this).data('eventObject');

                            // we need to copy it, so that multiple events don't have a reference to the same object
                            var copiedEventObject = $.extend({}, originalEventObject);

                            // assign it the date that was reported
                            copiedEventObject.start = date;
                            copiedEventObject.allDay = allDay;

                            // render the event on the calendar
                            // the last `true` argument determines if the event "sticks" (http://arshaw.com/fullcalendar/docs/event_rendering/renderEvent/)
                            $('#calendar').fullCalendar('renderEvent', copiedEventObject, true);

                            // is the "remove after drop" checkbox checked?
                            if ($('#drop-remove').is(':checked')) {
                                // if so, remove the element from the "Draggable Events" list
                                $(this).remove();
                            }

                        },

                        events: [
                            {
                                id: 999,
                                title: 'Repeating Event',
                                start: new Date(y, m, d - 3, 16, 0),
                                allDay: false,
                                className: 'info'
                            },
                            // {
                            //     id: 999,
                            //     title: 'Repeating Event',
                            //     start: new Date(y, m, d + 4, 16, 0),
                            //     allDay: false,
                            //     className: 'info'
                            // },
                            // {
                            //     title: 'Meeting',
                            //     start: new Date(y, m, d, 10, 30),
                            //     allDay: false,
                            //     className: 'important'
                            // },
                            // {
                            //     title: 'Lunch',
                            //     start: new Date(y, m, d, 12, 0),
                            //     end: new Date(y, m, d, 14, 0),
                            //     allDay: false,
                            //     className: 'important'
                            // },
                            // {
                            //     title: '영어 공부',
                            //     start: new Date(y, m, 21),
                            //     allDay: true,
                            //     className: 'chill'
                            // },
                            //
                            // {
                            //     title: 'Click for Google',
                            //     start: new Date(y, m, 28),
                            //     end: new Date(y, m, 29),
                            //     url: 'http://google.com/',
                            //     className: 'success'
                            // }
                        ],
                    });

                    min = -1; // Minimum of 0
                    max = 10; // Maximum of 10
                    $('.count').prop('disabled', true);
                    $(".minus").on("click", function () {
                        if ($('.count').val() > min) {
                            $('.count').val(parseInt($('.count').val()) - 1);
                            $('.counter').text(parseInt($('.counter').text()) - 1);
                        }
                    });
                    $(".plus").on("click", function () {
                        if ($('.count').val() < max) {
                            $('.count').val(parseInt($('.count').val()) + 1);
                            $('.counter').text(parseInt($('.counter').text()) + 1);
                        }
                    });

                if ($.cookie('token') == undefined) {
                    window.location.href = '/login'
                }
                else {
                    load_user_info();
                }
            });


            window.onload = function() {
                showAdvice();
            }

            function showAdvice() {
                $.ajax({
                    type: "GET",
                    url: "/api/study",
                    data: {},
                    success: function (response) {
                        let advices = response['advices'];
                        let i = Math.random();
                        let advice = advices[Math.floor(i*(advices.length-1))]['advice'];
                        let temp = `<span id="advice">${advice}</span>`;
                        $('.advices').append(temp);
                    }
                });
            }

            function load_user_info() {
                $.ajax({
                    type: "GET",
                    url: "/api/nickname",
                    headers: {'token_give': $.cookie('token')},
                    data: {},
                    success: function (response) {
                        if (response['result'] == 'success') {
                            $('#nickname').text(response['nickname'])
                        } else {
                            window.location.href = '/login'
                        }
                    }
                })
            }

            function monthGoal() {
                if ($('.setPlan').css('display') == 'none') {
                    $('.panel-heading').text('월간 계획을 세워보세요!');
                    $('.setPlan').show();
                } else {
                    $('.setPlan').hide();
                }
            }

            function weekGoal(){
                if($('.setPlan').css('display') == 'none'){
                    $('.panel-heading').text('주간 계획을 세워보세요!');
                    $('.setPlan').show();
                }
                else {
                    $('.setPlan').hide();
                }
            }

            let count=0;

            function button_count(){
                count++;
            }

            function setTime(){
                $.ajax({
                    type:'POST',
                    url :'/api/timeRecord',
                    data:{'timeSet_give' : $('#myNumber').val(), 'count_give':count},
                    headers: {'token_give': $.cookie('token')},
                    success:function(response){
                        if(response['result']=='success') {
                            alert('시간 설정이 완료되었습니다');
                        }
                        else if(response['result']=='fail time') {
                            alert(response['result']);
                            window.location.href = '/login'
                        }
                    }
                })
                count=0;

                if($('.setTime').css('display')=='none') {
                    $('.setTime').show();
                }
                else {
                    $('.setTime').hide();
                }
            }

        </script>

        <style>
            body {
                margin-top: 40px;
                text-align: center;
                font-size: 14px;
            }

            #wrap {
                width: 1100px;
                margin: 0 auto;
                margin-top:20px;
            }

            #external-events {
                float: left;
                width: 150px;
                padding: 0 10px;
                text-align: left;
                }

            #external-events h4 {
                font-size: 16px;
                margin-top: 0;
                padding-top: 1em;
                }

            .external-event { /* try to mimick the look of a real event */
                margin: 10px 0;
                padding: 2px 4px;
                background: #3366CC;
                color: #fff;
                font-size: .85em;
                cursor: pointer;
                }

            #external-events p {
                margin: 1.5em 0;
                font-size: 11px;
                color: #666;
                }

            #external-events p input {
                margin: 0;
                vertical-align: middle;
                }

            #calendar {
        /* 		float: right; */
                margin: 0 auto;
                width: 900px;
                background-color: #FFFFFF;
                  border-radius: 6px;
                box-shadow: 0 1px 2px #C3C3C3;
                }
        </style>
    </head>

    <body>

        <div class="wrap">
            <div class="title">
                <h1>Study Planner</h1>
                <h5><span id="nickname"></span>님 환영합니다</h5>
            </div>

            <div class="advices">
            </div>

            <div class="Goals">
                <button onclick="monthGoal();">월간 계획</button>
                <button onclick="weekGoal();">주간 계획</button>
                <button onclick="setTime();">시간 설정</button>
            </div>

            <div class="setPlan" style="display:none">
             <div class="row">
              <div class="col-md-4" >
               <div class="panel panel-primary">
                <div class="panel-heading"></div>
                 <div class="panel-body">
                  <div class="right">
                      <textarea class="plan"></textarea>
                  </div>
                  </div>
                </div>
               </div>
              </div>
             </div>

            <div class="setTime" style="display:none">
              <div class="input-group spinner">
                <div class="input-group-prepend">
                  <button class="btn text-monospace minus" onclick="button_count();" type="button">-</button>
                </div>
                <input type="number" class="count form-control" id="myNumber" min="-1" max="10" step="1" value="-1">
                <div class="input-group-append">
                  <button class="btn text-monospace plus" onclick="button_count();" type="button">+</button>
                </div>
              </div>
            </div>

        </div>

        <div id='wrap'>
            <div id='calendar'></div>
            <div style='clear:both'></div>
        </div>

    </body>
</html>
